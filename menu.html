<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video hover reveal</title>
    <style>
        /* Container làm gốc định vị */
        .hero-video {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #000;
            overflow: hidden;
            cursor: pointer;
            /* giúp user biết có thể tương tác trên mobile */
        }

        /* Ảnh cover mặc định hiển thị */
        .hero-video__image {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            z-index: 0;
            pointer-events: none;
            user-select: none;
        }

        /* Video fill khung, ẩn mặc định */
        .hero-video__media {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 260ms ease;
            z-index: 1;
            /* bỏ pointer-events: none để cho mobile click vào container vẫn được,
         sự kiện ta gắn trên container */
        }

        /* Khi hover (desktop) hoặc khi active (JS toggle), video hiện lên */
        .hero-video:hover .hero-video__media,
        .hero-video.is-playing .hero-video__media {
            opacity: 1;
        }

        /* Caption overlay bám góc dưới trái */
        .hero-video__caption {
            position: absolute;
            left: clamp(12px, 2.5vw, 32px);
            bottom: clamp(12px, 2.5vw, 32px);
            color: #fff;
            font-weight: 500;
            font-size: clamp(18px, 3vw, 36px);
            line-height: 1.2;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
            z-index: 2;
            /* trên cả video */
            pointer-events: none;
            /* không cản trở tương tác */
        }

        .hero-video,
        .hero-video * {
            box-sizing: border-box;
        }

        /* Giảm chuyển động cho người dùng chọn reduce motion */
        @media (prefers-reduced-motion: reduce) {
            .hero-video__media {
                transition: none;
            }
        }
    </style>
</head>

<body>
    <div class="hero-video" aria-label="Bugatti Tourbillon video teaser" role="button">
        <!-- Ảnh cover hiển thị trước -->
        <img class="hero-video__image" alt="a blue bugatti chiron is sitting on a dark surface"
            src="https://bugatti.imgix.net/6733871ced9d56f31c5f0182/bugatti-tourbillon-card.jpg?auto=format,compress&amp;cs=srgb&amp;sharp=10&amp;w=1200&amp;dpr=1" />

        <!-- Video ẩn (opacity 0) cho đến khi hover / active -->
        <video class="hero-video__media"
            src="uploads/2026/bugatti/tourbillon/2025-model-teaser-videos-tourbillon_720.mp4?fm=mp4&amp;w=1920&amp;video-codec=av1&amp;video-bitrate=2m"
            playsinline autoplay muted loop preload="none" <!-- quan trọng: không tải trước -->
            ></video>

        <div class="hero-video__caption">Tourbillon</div>
    </div>

    <script>
        (function () {
            const container = document.querySelector('.hero-video');
            const video = container.querySelector('.hero-video__media');

            if (!container || !video) return;

            // Helper: play/pause safe (bắt promise play bị reject vì policy)
            const safePlay = () => {
                // Khi hover lần đầu, bắt đầu load video
                if (video.preload === 'none') {
                    // Đổi preload để browser bắt đầu tải khi cần
                    video.preload = 'metadata';
                    // Với một số trình duyệt, gọi load() kích hoạt pipeline
                    if (video.load) try { video.load(); } catch (e) { }
                }
                const p = video.play();
                if (p && typeof p.catch === 'function') {
                    p.catch(() => {/* ignore autoplay reject */ });
                }
            };

            const safePauseAndReset = () => {
                try { video.pause(); } catch (e) { }
                // Reset về đầu cho lần hover sau
                try { video.currentTime = 0; } catch (e) { }
            };

            // --- Desktop hover ---
            container.addEventListener('mouseenter', () => {
                container.classList.add('is-playing');
                safePlay();
            });

            container.addEventListener('mouseleave', () => {
                container.classList.remove('is-playing');
                safePauseAndReset();
            });

            // --- Mobile: toggle bằng tap ---
            // (mobile không có hover, nên dùng click để bật/tắt)
            let isTouch = false;
            window.addEventListener('touchstart', () => { isTouch = true; }, { passive: true });

            container.addEventListener('click', () => {
                // Chỉ xử lý toggle trên thiết bị có touch (hoặc nếu bạn muốn cả desktop click)
                if (!isTouch) return;
                const active = container.classList.toggle('is-playing');
                if (active) safePlay(); else safePauseAndReset();
            });

            // Tối ưu: dừng video khi rời khỏi viewport (tiết kiệm tài nguyên)
            if ('IntersectionObserver' in window) {
                const io = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (!entry.isIntersecting) {
                            container.classList.remove('is-playing');
                            safePauseAndReset();
                        }
                    });
                }, { threshold: 0.1 });
                io.observe(container);
            }
        })();
    </script>
</body>

</html>